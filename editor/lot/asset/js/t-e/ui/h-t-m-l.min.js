/*!
 * ==========================================================
 *  HTML TEXT EDITOR PLUGIN 1.5.1
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.ui.HTML=function(e,t){function D(e){return e.split(m("("+U[3]+")+"))[0]}function M(e){return j=e.match(/(?:^|\n)([\t ]*).*$/),j&&j[1]||""}function F(e,t,r){var d,n=f.$(),l=n.value,i=n.before,a=q[t]||t,o=q[r]||r,s=D(a),c=D(o),u=M(i),p=E[""];return B=a,f[0](),l&&l!==p?(f.tidy("\n\n","").replace(/[\t ]*\n[\t ]*/g,S[0]+S[2]+c+S[1]+"\n"+O+S[0]+o+S[1]).wrap(S[0]+a+S[1]+"\n"+O+S[0]+o+S[1],S[0]+S[2]+c+S[1]+"\n"+S[0]+S[2]+s+S[1]+"\n\n",1).replace(m("\\n"+h(O)+H[0]+h(o)+H[1]+"\\s*"+H[0]+H[2]+h(c)+H[1]+"\\n","g"),"\n"+S[0]+S[2]+s+S[1]+"\n\n"+S[0]+a+S[1]+"\n").select(f.$().end),w&&y.tools.p.click(e,f)):(d=i.match(m("(?:^|\\n)[\\t ]+"+H[0]+"("+H[2]+"?)(?:"+h(D(q.ul))+"|"+h(D(q.ol))+")"+R+H[1]+"\\s*$")))?f.insert("\n"+u+(d[1]?"":O),0):(d=i.match(m(H[0]+h(c)+C+H[1]+".*?$")))?m(H[0]+H[2]+h(c)+H[1]+"\\s*$").test(i)?f.tidy("\n"+u,!1).insert(p).wrap(S[0]+c+d[1]+S[1],S[0]+S[2]+c+S[1]):m(H[1]+"\\s*$").test(i)?f.insert(p).wrap("\n"+u+O+S[0]+a+S[1]+"\n"+u+O+O+S[0]+c+d[1]+S[1],S[0]+S[2]+c+S[1]+"\n"+u+O+S[0]+S[2]+s+S[1]+"\n"+u).scroll(2):f.insert(S[0]+S[2]+c+S[1]+"\n"+u+S[0]+c+d[1]+S[1],0).insert(p).scroll(1):m(H[0]+H[2]+h(c)+H[1]+"\\s*$").test(i)?f.insert(p).wrap("\n"+u+S[0]+o+S[1],S[0]+S[2]+c+S[1]):f.tidy("\n\n").insert(p).wrap(S[0]+a+S[1]+"\n"+O+S[0]+o+S[1],S[0]+S[2]+c+S[1]+"\n"+S[0]+S[2]+s+S[1]),f[1](),!1}function A(e,t){return!t.get(0)&&w&&y.tools.p.click(e,t),t}function N(e){return g(e.replace(/\s+/g," "))}function Q(e){return v(N(e),[m(H[0]+".*?"+H[1],"g"),'"',"'"],["","&#34;","&#39;"])}function G(e){return v(N(e),[m(H[0]+".*?"+H[1],"g"),/\s/g,'"'],["","%20","%22"])}var B,j,r="–",n="…",l="↑",i="↓",a="↵",o="⌘",s="✘",c="⇧",f=TE.ui(e,{auto_encode_html:1,auto_p:1,tools:"clear | b i u s | sub sup | abbr | a img | p,h1,h2,h3,h4,h5,h6 | blockquote,q pre,code | ul ol | indent outdent | table | hr | undo redo",states:{tr:[1,10],td:[1,10],a:{},img:{},abbr:{}},languages:{tools:{clear:["Clear Format",s],b:["Bold",o+"+B"],i:["Italic",o+"+I"],u:["Underline",o+"+U"],s:["Strike",o+"+"+s],a:["Link",o+"+L"],img:["Image",o+"+G"],sub:["Subscript",o+"+"+i],sup:["Superscript",o+"+"+l],abbr:["Abbreviation",o+"+"+c+"+?"],p:["Paragraph",o+"+"+a],br:["Line Break",c+"+"+a],"p,h1,h2,h3,h4,h5,h6":["H1 "+r+" H6",o+"+H"],"blockquote,q":["Quote",o+"+Q"],"pre,code":["Code",o+"+K"],ul:["Unordered List",o+"+-"],ol:["Ordered List",o+"++"],table:["Table",o+"+T"],hr:["Horizontal Rule",o+"+R"]},modals:{a:{title:["Link URL","Link Title"],placeholder:["http://","link title here"+n]},img:{title:["Image URL","Image Title","Image Caption"],placeholder:["http://","image title here"+n,"image caption here"+n]},abbr:{title:"Abbreviation",placeholder:"meaning here"+n},table:{title:["Number of Columns","Number of Rows","Table Caption"],placeholder:["3","3","table caption here"+n]}},placeholders:{table:["Table Head %1.%2","Table Data %1.%2","Table Foot %1.%2"]}},advance_a:1,advance_img:1,advance_table:1,formats:{b:"strong",i:"em",u:"u",s:'del datetime="%1-%2-%3"',a:"a",figure:"figure",figcaption:"figcaption",img:"img",sub:"sub",sup:"sup",abbr:"abbr",p:"p",br:"br",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",blockquote:"blockquote",q:"q",pre:"pre",code:"code",ul:"ul",ol:"ol",li:"li",table:'table border="1"',caption:"caption",thead:"thead",tbody:"tbody",tfoot:"tfoot",tr:"tr",th:"th",td:"td",hr:"hr"}}),u=f._,p=u.edge,h=u.x,d=u.extend,b=u.i,m=u.pattern,g=u.trim,$=u.format,v=u.replace,k=d(f.config,t),y=f.ui,w=k.auto_p,q=(k.classes,k.formats),T=k.languages,x=k.states,L=k.suffix,O=k.tab,S=k.union[1][0],I=k.union[1][1],H=k.union[0][0],U=k.union[0][1],R="(?:"+U[3]+"[^"+H[0]+H[1]+"]*?)?",C="(|"+U[3]+"[^"+H[0]+H[1]+"]*?)",z="([\\s\\S]*?)",E=T.placeholders;return f.type="HTML",d(y.tools,{clear:{i:"remove-format",click:function(e,t){var a,r=t[0]().$(),n=r.before,l=r.after,i=r.value,o=H[0]+"[^"+H[0]+H[1]+"]+?"+H[1],s=H[0]+"[^"+H[2]+H[0]+H[1]+"]+?"+H[1],c=H[0]+H[2]+"[^"+H[0]+H[1]+"]+?"+H[1];return!i&&l&&(a=m("^"+o)).test(l)?(t.replace(a,"",1),!1):(m(o).test(i)||n.slice(-1)===S[1]||l[0]===S[0]?t.replace(m(o,"g"),"").unwrap(m(s),m(c)):t.insert(""),t[1](),!!l)}},b:{i:"bold",click:function(e,t){return A(e,t).i().format(q.b),!1}},i:{i:"italic",click:function(e,t){return A(e,t).i().format(q.i),!1}},u:{i:"underline",click:function(e,t){return A(e,t).i().format(q.u),!1}},s:{i:"strike",click:function(e,t){return A(e,t).i().format($(q.s,t._.time())),!1}},a:{i:"link",click:function(e,t){var l,i,r=q.a,n=T.modals.a;return y.prompt(n.title[0],n.placeholder[0],1,function(e,t,a){a=G(a),l=a;var s,c,o=location.host;-1!==l.indexOf("://")&&(s=1),""!==o&&-1!==l.indexOf("://"+o)&&(s=0),/^([.\/?&#]|javascript:)/.test(l)&&(s=0),y.prompt(n.title[1],n.placeholder[1],0,function(e,t,n){i=Q(n),A(e,t).$().length||t.insert(E[""]),c=k.advance_a&&s?I[3]+"rel"+I[0]+I[1]+"nofollow"+I[2]+I[3]+"target"+I[0]+I[1]+"_blank"+I[2]:"",t.i().format(r+I[3]+"href"+I[0]+I[1]+l+I[2]+(i?I[3]+"title"+I[0]+I[1]+i+I[2]:"")+c)},0,0,"a[title]")},0,0,"a[href]").record(),!1}},img:{i:"image",click:function(e,t){var c,f,r=t.$(),n=q.img,l=q.figure,i=q.figcaption,a=r.value,o=T.modals.img,s=k.advance_img;return y.prompt(o.title[0],o.placeholder[0],1,function(e,t,r){r=G(r),c=r,y.prompt(o.title[s?2:1],o.placeholder[s?2:1],0,function(e,t,r){f=Q(r),a||(a=c.split(/[\/\\\\]/).pop()),a=Q(a),t[0](),s&&f?(t.tidy("\n\n","").insert(S[0]+l+S[1]+"\n"+O+S[0]+n+I[3]+"alt"+I[0]+I[1]+a+I[2]+I[3]+"src"+I[0]+I[1]+c+I[2]+L+"\n"+O+S[0]+i+S[1]+f+S[0]+S[2]+D(i)+S[1]+"\n"+S[0]+S[2]+D(l)+S[1]+"\n\n",0,1),w&&y.tools.p.click(e,t)):A(e,t).tidy(m(H[0]+"[^"+H[0]+H[1]+H[2]+"]+?"+H[1]+"\\s*$").test(t.$().before)?"":" ","").insert(S[0]+n+I[3]+"alt"+I[0]+I[1]+a+I[2]+I[3]+"src"+I[0]+I[1]+c+I[2]+(f?I[3]+"title"+I[0]+I[1]+f+I[2]:"")+L+" ",0,1),t[1]()},0,0,"img[title]")},0,0,"img[src]"),!1}},sub:{i:"subscript",click:function(e,t){var r=q.sub,n=q.sup,l=D(n);return A(e,t)[0]().unwrap(m(H[0]+h(l)+R+H[1]),S[0]+S[2]+l+S[1]).i().format(r)[1](),!1}},sup:{i:"superscript",click:function(e,t){var r=q.sub,n=q.sup,l=D(r);return A(e,t)[0]().unwrap(m(H[0]+h(l)+R+H[1]),S[0]+S[2]+l+S[1]).i().format(n)[1](),!1}},abbr:{i:"abbreviation",click:function(e,t){var d,b,r=t.$(),n=g(r.value),l=T.modals.abbr,i=t.get(),a=g(n||E[""]),o=q.abbr,s=D(o),c=H[0]+h(o)+C+H[1],f=H[0]+h(o)+R+H[1],u=H[0]+H[2]+h(s)+H[1],p=m(c+z+u);return i.replace(p,function(e,t,r){(r=g(r))&&(x.abbr[r]=(t.match(m(U[3]+"+title"+U[0]+U[1]+"\\s*(.*?)\\s*"+U[2]))||["",""])[1])}),d=x.abbr,n&&d[n]?(t.i().format(o+I[3]+"title"+I[0]+I[1]+d[n]+I[2]),!1):(y.prompt(l.title,d[a]||l.placeholder,!d[n],function(e,t,r,l){r=Q(r||l),t[0](),n||t.insert(r.replace(/[^a-z\d]/gi," ").replace(/([a-z\d])[^ ]* */gi,"$1").toUpperCase());for(b in d)if(Q(d[b])===r){t.insert(b);break}A(e,t).unwrap(m(f),m(u)).unwrap(m(f),m(u),1).i().format(o+I[3]+"title"+I[0]+I[1]+r+I[2])[1]()},0,0,"abbr[title]").record(),!1)}},p:{i:"paragraph",click:function(e,t){var p,r=t.$(),n=r.value,l=q.p,i=q.br,a=D(l),o=D(i),s=r.before,c=r.after,f=M(s),u=E[""];if(t[0](),n&&-1!==n.indexOf("\n")){var d=m("^(?:\\s*"+H[0]+h(a)+R+H[1]+"\\s*)+"+z+"(?:\\s*"+H[0]+H[2]+h(a)+H[1]+"\\s*)+$");d.test(n)?t.replace(d,"$1").replace(m("\\s*"+H[0]+H[2]+h(a)+H[1]+"\\s*"+H[0]+h(a)+R+H[1]+"\\s*","g"),"\n\n").replace(m("\\s*"+H[0]+h(o)+R+H[1]+"\\s*","g"),"\n"):t.replace(/\n/g,"\n"+S[0]+i+L+"\n").replace(m("(\\s*"+H[0]+h(o)+R+L+"\\s*){2,}","g"),S[0]+S[2]+a+S[1]+"\n"+S[0]+l+S[1]).wrap(S[0]+l+S[1],S[0]+S[2]+a+S[1],1).replace(m("("+H[0]+h(a)+R+H[1]+")+","g"),"$1").replace(m("("+H[0]+H[2]+h(a)+H[1]+")+","g"),"$1").tidy("\n")}else m("^\\s*"+H[0]+H[2]+h(a)+H[1]).test(c)?m(H[0]+h(a)+R+H[1]+"\\s*$").test(s)?t.unwrap(m("\\s*"+H[0]+h(a)+R+H[1]+"\\s*"),m("\\s*"+H[0]+H[2]+h(a)+H[1])).replace(u,"").tidy("\n","\n"+f):(p=s.match(m(H[0]+h(a)+C+H[1]+".*?$")))&&t.wrap(S[0]+S[2]+a+S[1]+"\n"+f+S[0]+a+p[1]+S[1],"").insert(u).scroll(1):t.tidy("\n\n").format(l,0,"\n\n").scroll(1);return t[1](),!1}},br:{i:"break",click:function(e,t){return j=M(t.$().before),t.tidy("\n","").insert(j+S[0]+q.br+L+"\n",0).scroll(1),!1}},"p,h1,h2,h3,h4,h5,h6":{i:"headers",click:function(e,t){var i,a,r=t.$(),n=[q.p,q.h1,q.h2,q.h3,q.h4,q.h5,q.h6],l=[];for(i in n)l[i]=D(n[i]);var s=(h(n).join("|"),h(l).join("|")),c="\\s*"+H[0]+"("+s+")"+C+H[1]+"\\s*",f=m("\\s*"+H[0]+"(?:"+s+")"+R+H[1]+"\\s*"),u=m("\\s*"+H[0]+H[2]+"(?:"+s+")"+H[1]+"\\s*"),p=r.value.match(m("^"+c));return p||(p=r.before.match(m(c+"$"))||[]),a=p[2]||"",i=+(p[1]||"h0").slice(1),t[0]().unwrap(f,u).unwrap(f,u,1).i().tidy("\n\n").format(i>5?l[0]+a:l[i+1]+a,0,"\n\n")[1](),!1}},"blockquote,q":{i:"quote",click:function(e,t){var u,r=t.$(),n=r.value,l=q.blockquote,i=q.q,a=q.p,o=D(a),s=h(o),c=m(H[0]+H[2]+s+H[1]),f=E[""];return/(^|\n)$/.test(r.before)?(w&&!c.test(n)&&y.tools.p.click(e,t),r=t.$(),n=r.value,!c.test(n)&&w&&t.select(r.start-(S[0]+a+S[1]).length,r.end+(S[0]+S[2]+o+S[1]).length),n!==f&&w?(t[0]().tidy("\n\n").insert(S[0]+l+S[1]+"\n"+t.$().value.replace(m("^(\\s*"+H[0]+")","gm"),O+"$1")+"\n"+S[0]+S[2]+D(l)+S[1]+"\n\n",0,1),w&&y.tools.p.click(e,t)):(t[0]().format(l,0,"\n\n","\n").loss().replace(m("^(\\s*"+H[0]+")","gm"),O+"$1"),w&&(r=t.$(),u=r.start+(S[0]+a+S[1]+O).length,t.select(u,u+f.length))),t[1]()):t.i().format(i),!1}},"pre,code":{i:"code",click:function(e,t){function b(e){return l?v(e,["&","<",">"],["&amp;","&lt;","&gt;"]):e}function g(e){return l?v(e,["&amp;","&lt;","&gt;"],["&","<",">"]):e}var r=t.$(),n=r.value,l=k.auto_encode_html,i=q.pre,a=q.code,o=D(i),s=D(a),c=H[0]+h(o)+R+H[1]+"\\s*"+H[0]+h(s)+R+H[1]+"\\s*",f="\\s*"+H[0]+H[2]+h(s)+H[1]+"\\s*"+H[0]+H[2]+h(o)+H[1],u=m(c+"\\s*$"),p=m("^\\s*"+f),d=m("^"+z+"$");return m("(^|\\n|"+c+")$").test(r.before)?u.test(r.before)&&p.test(r.after)?t[0]().unwrap(m(u),m(p)).replace(d,g)[1]():t[0]().tidy("\n\n").wrap(S[0]+i+S[1]+S[0]+a+S[1],S[0]+S[2]+s+S[1]+S[0]+S[2]+o+S[1]).insert(n||E[""]).replace(d,b)[1]():t[0]().format(a).replace(d,function(e){return N(m("^\\s*"+H[0]+H[2]+h(s)+H[1]).test(t.$().after)?b(e):g(e))})[1](),!1}},ul:{i:"list-bullet",click:function(e,t){var r=q.ol,n=q.ul,l=D(r),i=D(n),a="("+h(i)+"|"+h(l)+")";return t.match(m(H[0]+a+R+H[1]+z+H[0]+H[2]+a+H[1]))?t[0]().replace(m(H[0]+h(l)+C+H[1],"g"),S[0]+i+"$1"+S[1]).replace(m(H[0]+H[2]+h(l)+H[1],"g"),S[0]+S[2]+i+S[1])[1]():F(e,n,q.li),!1}},ol:{i:"list-number",click:function(e,t){var r=q.ol,n=q.ul,l=D(r),i=D(n),a="("+h(i)+"|"+h(l)+")";return t.match(m(H[0]+a+R+H[1]+z+H[0]+H[2]+a+H[1]))?t[0]().replace(m(H[0]+h(i)+C+H[1],"g"),S[0]+l+"$1"+S[1]).replace(m(H[0]+H[2]+h(i)+H[1],"g"),S[0]+S[2]+l+S[1])[1]():F(e,r,q.li),!1}},table:function(e,t){var E,B,j,M,r=x.tr,n=x.td,l=T.modals.table,i=T.placeholders.table,a=g($(i[0],[1,1])),o=k.advance_table?O:"",s=q.table,c=q.caption,f=q.thead,u=q.tbody,h=q.tfoot,d=q.tr,m=q.th,v=q.td,w=D(s),_=D(c),L=D(f),I=D(u),H=D(h),U=D(d),R=D(m),C=D(v),z=[];return t[0]().$().value===a?(t.select(),!1):(y.prompt(l.title[0],l.placeholder[0],0,function(e,t,k,q){B=p(b(k)||q,n[0],n[1]),y.prompt(l.title[1],l.placeholder[1],0,function(e,t,n,k){j=p(b(n)||k,r[0],r[1]),y.prompt(l.title[2],l.placeholder[2],0,function(e,t,r){var l,p,b,y,q,n="";for(M=N(r),l=0;j>l;++l){for(E=o+O+S[0]+d+S[1]+"\n",p=0;B>p;++p)E+=o+O+O+S[0]+v+S[1]+g($(i[1],[l+1,p+1]))+S[0]+S[2]+C+S[1]+"\n";E+=o+O+S[0]+S[2]+U+S[1],z.push(E)}for(z=z.join("\n"),E=O+(o?S[0]+f+S[1]+"\n"+O+O+S[0]+d+S[1]:S[0]+U+S[1])+"\n",b=0;B>b;++b)E+=o+O+O+S[0]+m+S[1]+g($(i[0],[1,b+1]))+S[0]+S[2]+R+S[1]+"\n";if(o){for(n+=O+S[0]+h+S[1]+"\n",n+=O+O+S[0]+d+S[1]+"\n",b=0;B>b;++b)n+=O+O+O+S[0]+v+S[1]+g($(i[2],[1,b+1]))+S[0]+S[2]+C+S[1]+"\n";n+=O+O+S[0]+S[2]+d+S[1]+"\n",n+=O+S[0]+S[2]+H+S[1]+"\n"}E+=o+O+S[0]+S[2]+U+S[1]+(o?"\n"+O+S[0]+S[2]+L+S[1]+"\n"+n+O+S[0]+u+S[1]:"")+"\n",z=E+z+(o?"\n"+O+S[0]+S[2]+I+S[1]:"")+"\n",t.tidy("\n\n").insert(S[0]+s+S[1]+"\n"+(M&&c?O+S[0]+c+S[1]+M+S[0]+S[2]+_+S[1]+"\n":"")+z+S[0]+S[2]+w+S[1]),y=t.$(),q=y.start+y.value.indexOf(a),t.select(q,q+a.length)[1]()},0,0,"table>caption")},0,0,"table>tr")},0,0,"table>td"),!1)},hr:{i:"horizontal-rule",click:function(e,t){return j=M(t.$().before),t.tidy("\n\n","").insert(j+S[0]+q.hr+L+"\n\n",0),!1}}}),k.keys&&d(y.keys,{"delete":"clear","control+delete":"s","control+b":"b","control+i":"i","control+u":"u","control+l":"a","control+g":"img","control+down":"sub","control+up":"sup","control+shift+?":"abbr","control+enter":"p","shift+enter":"br",enter:function(e,t){var p,d,b,r=t.$(),n=r.value,l=t.get(),i=q.p,a=q.li,o=D(i),s=D(a),f=(M(r.before),E[""]),u=y.tools;if(!n||n===f){if(p=r.after.match(m("^\\s*"+H[0]+H[2]+"("+h(o)+"|"+h(s)+")"+H[1])))d=p[1],(u[d===s?B:d]||u.ul).click(e,t);else{if(!(w&&i&&g(l)&&r.end===l.length&&m("^\\s*[^"+H[0]+"\\n]*?[^"+H[1]+"]\\s*$").test(l)))return;l=S[0]+i+S[1]+l+S[0]+S[2]+o+S[1]+"\n"+S[0]+i+S[1],b=f+S[0]+S[2]+o+S[1],t.set(l+b).select(l.length,(l+f).length)}return!1}},tab:function(e,t){var r=t.$(),n=q.li,l=D(n),i=M(r.before);return m(H[0]+H[2]+h(l)+H[1]).test(r.after)?(t[0]().wrap("\n"+i+O+S[0]+(q[B]||B)+S[1]+"\n"+i+O+O+S[0]+n+S[1],S[0]+S[2]+l+S[1]+"\n"+i+O+S[0]+S[2]+B+S[1]+"\n"+i).insert(E[""])[1](),!1):y.tools.indent.click(e,t)},back:function(e,t){var l,r=t.$(),n=r.value,i=r.before,a=r.after,o=H[0]+"[^"+H[0]+H[1]+"]+?"+H[1];return!n&&m(o+"$").test(i)?(l=i.split(S[0]).pop().match(m("^([^"+H[2]+"\\s]+).*?"+H[1]+"\\s*$")),l=l&&l[1]||0,l&&m("^\\s*"+H[0]+H[2]+h(l)+H[1]).test(a)?t.unwrap(m(H[0]+h(l)+R+H[1]),m("\\s*"+H[0]+H[2]+h(l)+H[1])):t.outdent(m(o)),!1):void 0},"control+h":"p,h1,h2,h3,h4,h5,h6","control+q":"blockquote,q","control+k":"pre,code","control+-":"ul","control++":"ol","control+=":"ol","control+shift++":"ol","control+t":"table","control+r":"hr"}),f.update(t,0)};